buildscript {
  ext.kotlin_version = '1.3.11'
  repositories {
    google()
    jcenter()
  }

  dependencies {
    classpath 'com.android.tools.build:gradle:3.4.1'
    classpath 'com.netflix.nebula:gradle-lint-plugin:7.4.0'
    classpath 'com.nabilhachicha:android-native-dependencies:0.1.2'
    classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
  }
}

ext {

  /*
   * The version of the NYPL Audiobook API used by this package.
   */

  nypl_audiobook_api_version = "2.0.2"

  /*
   * The version of the NYPL AudioEngine provider used by this package.
   */

  nypl_audiobook_findaway_version = "2.0.0"

  /*
   * The minimum SDK target.
   */

  androidMinimumSDK = 21
}

allprojects {
  group = 'org.nypl.simplified'
  version = '2.1.1'

  apply plugin: 'maven'
  apply plugin: 'nebula.lint'

  gradleLint.alwaysRun = false
  gradleLint.rules = ['all-dependency']
}

subprojects {
  repositories {
    mavenLocal()
    maven {
      credentials {
        username findProperty("org.librarysimplified.nexus.username")
        password findProperty("org.librarysimplified.nexus.password")
      }
      url "https://nexus.librarysimplified.org:8443/nexus/content/groups/external/"
    }
    maven { url "http://repo.maven.apache.org/maven2" }
    maven { url "https://jitpack.io" }
    // Needed for support-v4 26.0.0+
    maven { url "https://maven.google.com" }

    jcenter()

    if (project.hasProperty("org.librarysimplified.with_findaway")) {
      if (project.property("org.librarysimplified.with_findaway") == "true") {
        maven {
          url "http://maven.findawayworld.com/artifactory/libs-release/"
        }
      }
    }
  }

  // Android dependency has different version for the compile and runtime
  project.configurations.all {
    resolutionStrategy.eachDependency { details ->
      if (details.requested.group == 'com.android.support'
              && !details.requested.name.contains('multidex') ) {
        details.useVersion "27.1.1"
      }
    }
  }
}
