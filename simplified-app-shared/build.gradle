def getGitHash = { ->
  def stdout = new ByteArrayOutputStream()
  exec {
    commandLine "git", "rev-parse", "HEAD"
    standardOutput = stdout
  }
  return stdout.toString().trim()
}

android {
  defaultConfig {
    buildConfigField "String", "GIT_COMMIT", "\"${getGitHash()}\""
  }

  packagingOptions {
    exclude "META-INF/LICENSE"

    // The PDF library and Readium both provide this shared library. This will
    // cause the build to fail because Gradle doesn"t know which one to pick.
    pickFirst "lib/arm64-v8a/libc++_shared.so"
    pickFirst "lib/armeabi-v7a/libc++_shared.so"
    pickFirst "lib/x86/libc++_shared.so"
  }
}

dependencies {

  api project(":simplified-accounts-api")
  api project(":simplified-accounts-database")
  api project(":simplified-accounts-database-api")
  api project(":simplified-accounts-json")
  api project(":simplified-accounts-registry")
  api project(":simplified-accounts-registry-api")
  api project(":simplified-accounts-source-resolution")
  api project(":simplified-analytics-api")
  api project(":simplified-books-api")
  api project(":simplified-books-bundled-api")
  api project(":simplified-books-controller")
  api project(":simplified-books-controller-api")
  api project(":simplified-books-covers")
  api project(":simplified-books-database")
  api project(":simplified-books-database-api")
  api project(":simplified-books-registry-api")
  api project(":simplified-boot-api")
  api project(":simplified-branding")
  api project(":simplified-bugsnag")
  api project(":simplified-cardcreator")
  api project(":simplified-datepicker")
  api project(":simplified-documents")
  api project(":simplified-downloader-core")
  api project(":simplified-feeds-api")
  api project(":simplified-files")
  api project(":simplified-futures")
  api project(":simplified-http-core")
  api project(":simplified-json-core")
  api project(":simplified-notifications")
  api project(":simplified-observable")
  api project(":simplified-opds-auth-document")
  api project(":simplified-opds-auth-document-api")
  api project(":simplified-opds-core")
  api project(":simplified-parser-api")
  api project(":simplified-patron")
  api project(":simplified-patron-api")
  api project(":simplified-prefs")
  api project(":simplified-profiles")
  api project(":simplified-profiles-api")
  api project(":simplified-profiles-controller-api")
  api project(":simplified-reader-api")
  api project(":simplified-reader-bookmarks")
  api project(":simplified-reader-bookmarks-api")
  api project(":simplified-reports")
  api project(":simplified-splash")
  api project(":simplified-stack")
  api project(":simplified-tenprint")
  api project(":simplified-theme")
  api project(":simplified-threads")

  annotationProcessor libraries.googleAutoValue

  implementation libraries.androidAsync
  implementation libraries.androidXAppCompat
  implementation libraries.androidXConstraintLayout
  implementation libraries.androidXLegacyPreferenceV14
  implementation libraries.androidXLegacySupport
  implementation libraries.androidXMultidex
  implementation libraries.bugsnag
  implementation libraries.commonsLang
  implementation libraries.googleAndroidMaterial
  implementation libraries.googleAutoValue
  implementation libraries.googleGSON
  implementation libraries.googleZXing
  implementation libraries.io7mJFunctional
  implementation libraries.io7mJNull
  implementation libraries.jacksonCore
  implementation libraries.jacksonDatabind
  implementation libraries.jacksonKotlin
  implementation libraries.javaxAnnotationAPI
  implementation libraries.jodahExpiringMap
  implementation libraries.jodaTime
  implementation libraries.journeyappsZXing
  implementation libraries.kotlinStdlib
  implementation libraries.nanoHTTPD
  implementation libraries.nyplAudioBookAPI
  implementation libraries.nyplAudioBookDownloads
  implementation libraries.nyplAudioBookManifestNYPL
  implementation libraries.nyplAudioBookOpenAccess
  implementation libraries.nyplAudioBookViews
  implementation libraries.nyplDRMCore
  implementation libraries.nyplPDFAPI
  implementation libraries.nyplPDFViewer
  implementation libraries.picasso
  implementation libraries.readium
  implementation libraries.readiumSharedJS
  implementation libraries.slf4j
  implementation libraries.viewPagerIndicator

  implementation libraries.logbackAndroidCore
  implementation(libraries.logbackAndroidClassic) {
    // https://github.com/tony19/logback-android/issues/73
    exclude group: "com.google.android", module: "android"
  }

  if (project.hasProperty("org.librarysimplified.with_findaway")) {
    if (project.property("org.librarysimplified.with_findaway") == "true") {
      implementation libraries.nyplFindaway
    }
  }
}
