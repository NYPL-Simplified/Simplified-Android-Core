def getGitHash = { ->
  def stdout = new ByteArrayOutputStream()
  exec {
    commandLine "git", "rev-parse", "HEAD"
    standardOutput = stdout
  }
  return stdout.toString().trim()
}

android {
  defaultConfig {
    buildConfigField "String", "GIT_COMMIT", "\"${getGitHash()}\""
  }

  packagingOptions {
    exclude "META-INF/LICENSE"

    // The PDF library and Readium both provide this shared library. This will
    // cause the build to fail because Gradle doesn"t know which one to pick.
    pickFirst "lib/arm64-v8a/libc++_shared.so"
    pickFirst "lib/armeabi-v7a/libc++_shared.so"
    pickFirst "lib/x86/libc++_shared.so"
  }
}

dependencies {

  api project(":simplified-accounts-api")
  api project(":simplified-accounts-database")
  api project(":simplified-accounts-database-api")
  api project(":simplified-accounts-json")
  api project(":simplified-accounts-registry")
  api project(":simplified-accounts-registry-api")
  api project(":simplified-accounts-source-resolution")
  api project(":simplified-analytics-api")
  api project(":simplified-books-api")
  api project(":simplified-books-bundled-api")
  api project(":simplified-books-controller")
  api project(":simplified-books-controller-api")
  api project(":simplified-books-covers")
  api project(":simplified-books-database")
  api project(":simplified-books-database-api")
  api project(":simplified-books-registry-api")
  api project(":simplified-boot-api")
  api project(":simplified-branding")
  api project(":simplified-bugsnag")
  api project(":simplified-cardcreator")
  api project(":simplified-datepicker")
  api project(":simplified-documents")
  api project(":simplified-downloader-core")
  api project(":simplified-feeds-api")
  api project(":simplified-files")
  api project(":simplified-futures")
  api project(":simplified-http-core")
  api project(":simplified-json-core")
  api project(":simplified-notifications")
  api project(":simplified-observable")
  api project(":simplified-opds-auth-document")
  api project(":simplified-opds-auth-document-api")
  api project(":simplified-opds-core")
  api project(":simplified-parser-api")
  api project(":simplified-patron")
  api project(":simplified-patron-api")
  api project(":simplified-prefs")
  api project(":simplified-profiles")
  api project(":simplified-profiles-api")
  api project(":simplified-profiles-controller-api")
  api project(":simplified-reader-api")
  api project(":simplified-reader-bookmarks")
  api project(":simplified-reader-bookmarks-api")
  api project(":simplified-reports")
  api project(":simplified-splash")
  api project(":simplified-stack")
  api project(":simplified-tenprint")
  api project(":simplified-theme")
  api project(":simplified-threads")

  annotationProcessor libraries.googleAutoValue

  api libraries.androidAsync
  api libraries.androidXAppCompat
  api libraries.androidXConstraintLayout
  api libraries.androidXLegacyPreferenceV14
  api libraries.androidXLegacySupport
  api libraries.androidXMultidex
  api libraries.bugsnag
  api libraries.commonsLang
  api libraries.googleAndroidMaterial
  api libraries.googleAutoValue
  api libraries.googleGSON
  api libraries.googleZXing
  api libraries.io7mJFunctional
  api libraries.io7mJNull
  api libraries.jacksonCore
  api libraries.jacksonDatabind
  api libraries.jacksonKotlin
  api libraries.javaxAnnotationAPI
  api libraries.jodahExpiringMap
  api libraries.jodaTime
  api libraries.journeyappsZXing
  api libraries.kotlinStdlib
  api libraries.nanoHTTPD
  api libraries.nyplAudioBookAPI
  api libraries.nyplAudioBookDownloads
  api libraries.nyplAudioBookManifestNYPL
  api libraries.nyplAudioBookOpenAccess
  api libraries.nyplAudioBookViews
  api libraries.nyplDRMCore
  api libraries.nyplPDFAPI
  api libraries.nyplPDFViewer
  api libraries.picasso
  api libraries.readium
  api libraries.readiumSharedJS
  api libraries.slf4j
  api libraries.viewPagerIndicator
  api libraries.instabug

  api libraries.logbackAndroidCore
  api(libraries.logbackAndroidClassic) {
    // https://github.com/tony19/logback-android/issues/73
    exclude group: "com.google.android", module: "android"
  }
}
